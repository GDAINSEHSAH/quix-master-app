<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Master Pro - Ultimate Knowledge Challenge</title>
    <link rel="stylesheet" href="css/style-enhanced.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#667eea">
    <link rel="manifest" href="manifest.json">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body data-theme="light">
    <!-- Audio Elements -->
    <audio id="correct-sound" preload="auto">
        <source src="assets/sounds/correct.mp3" type="audio/mpeg">
        <source src="assets/sounds/correct.ogg" type="audio/ogg">
    </audio>
    <audio id="wrong-sound" preload="auto">
        <source src="assets/sounds/wrong.mp3" type="audio/mpeg">
        <source src="assets/sounds/wrong.ogg" type="audio/ogg">
    </audio>
    <audio id="background-music" preload="auto" loop>
        <source src="assets/sounds/background.mp3" type="audio/mpeg">
        <source src="assets/sounds/background.ogg" type="audio/ogg">
    </audio>
    <audio id="powerup-sound" preload="auto">
        <source src="assets/sounds/powerup.mp3" type="audio/mpeg">
    </audio>
    <audio id="achievement-sound" preload="auto">
        <source src="assets/sounds/achievement.mp3" type="audio/mpeg">
    </audio>

    <div class="app-container">
        <!-- Enhanced Loading Screen -->
        <div id="loading-screen" class="screen active">
            <div class="loading-content">
                <div class="logo">
                    <h1 class="game-title">Quiz Master <span class="pro-badge">PRO</span></h1>
                    <p class="game-subtitle">Ultimate Knowledge Challenge</p>
                </div>
                <div class="loading-spinner"></div>
                <p class="loading-text">Loading amazing features...</p>
                <div class="loading-progress">
                    <div class="loading-bar"></div>
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div id="settings-panel" class="side-panel">
            <div class="panel-header">
                <h3><i class="fas fa-cog"></i> Settings</h3>
                <button class="close-panel" onclick="closeSettings()"><i class="fas fa-times"></i></button>
            </div>
            <div class="panel-content">
                <div class="setting-group">
                    <h4><i class="fas fa-paint-brush"></i> Theme</h4>
                    <div class="theme-selector">
                        <button class="theme-btn active" data-theme="light">
                            <i class="fas fa-sun"></i> Light
                        </button>
                        <button class="theme-btn" data-theme="dark">
                            <i class="fas fa-moon"></i> Dark
                        </button>
                        <button class="theme-btn" data-theme="neon">
                            <i class="fas fa-bolt"></i> Neon
                        </button>
                    </div>
                </div>

                <div class="setting-group">
                    <h4><i class="fas fa-volume-up"></i> Audio</h4>
                    <div class="audio-controls">
                        <label class="switch">
                            <input type="checkbox" id="sound-effects" checked>
                            <span class="slider">Sound Effects</span>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="background-music-toggle">
                            <span class="slider">Background Music</span>
                        </label>
                        <div class="volume-control">
                            <i class="fas fa-volume-down"></i>
                            <input type="range" id="volume-slider" min="0" max="100" value="50">
                            <i class="fas fa-volume-up"></i>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <h4><i class="fas fa-gamepad"></i> Gameplay</h4>
                    <label class="switch">
                        <input type="checkbox" id="auto-next" checked>
                        <span class="slider">Auto Next Question</span>
                    </label>
                    <label class="switch">
                        <input type="checkbox" id="show-timer" checked>
                        <span class="slider">Show Timer</span>
                    </label>
                    <label class="switch">
                        <input type="checkbox" id="vibration" checked>
                        <span class="slider">Vibration Feedback</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Achievements Panel -->
        <div id="achievements-panel" class="side-panel">
            <div class="panel-header">
                <h3><i class="fas fa-trophy"></i> Achievements</h3>
                <button class="close-panel" onclick="closeAchievements()"><i class="fas fa-times"></i></button>
            </div>
            <div class="panel-content">
                <div class="achievement-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="total-achievements">0</div>
                        <div class="stat-label">Unlocked</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-points">0</div>
                        <div class="stat-label">XP Points</div>
                    </div>
                </div>
                <div id="achievements-list" class="achievements-list">
                    <!-- Achievements will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Statistics Panel -->
        <div id="statistics-panel" class="side-panel">
            <div class="panel-header">
                <h3><i class="fas fa-chart-bar"></i> Statistics</h3>
                <button class="close-panel" onclick="closeStatistics()"><i class="fas fa-times"></i></button>
            </div>
            <div class="panel-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-questions-answered">0</div>
                        <div class="stat-label">Questions Answered</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="accuracy-rate">0%</div>
                        <div class="stat-label">Accuracy Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="study-time">0h</div>
                        <div class="stat-label">Study Time</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="current-streak">0</div>
                        <div class="stat-label">Current Streak</div>
                    </div>
                </div>
                <div class="performance-chart">
                    <canvas id="performance-canvas" width="400" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- Multiplayer Panel -->
        <div id="multiplayer-panel" class="side-panel">
            <div class="panel-header">
                <h3><i class="fas fa-users"></i> Multiplayer</h3>
                <button class="close-panel" onclick="closeMultiplayer()"><i class="fas fa-times"></i></button>
            </div>
            <div class="panel-content">
                <div class="multiplayer-options">
                    <button class="multiplayer-btn" onclick="createRoom()">
                        <i class="fas fa-plus"></i> Create Room
                    </button>
                    <button class="multiplayer-btn" onclick="joinRoom()">
                        <i class="fas fa-sign-in-alt"></i> Join Room
                    </button>
                    <div class="room-code-input">
                        <input type="text" id="room-code" placeholder="Enter room code" maxlength="6">
                        <button onclick="quickJoin()">Join</button>
                    </div>
                </div>
                <div id="room-info" class="room-info" style="display: none;">
                    <div class="room-details">
                        <h4>Room: <span id="current-room-code"></span></h4>
                        <div class="players-list" id="players-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Main Menu -->
        <div id="main-menu" class="screen">
            <div class="menu-header">
                <div class="header-top">
                    <div class="user-profile">
                        <div class="avatar" id="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-info">
                            <div class="username" id="username">Quiz Master</div>
                            <div class="user-level">Level <span id="user-level">1</span></div>
                            <div class="xp-bar">
                                <div class="xp-fill" style="width: 45%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button class="icon-btn" onclick="openSettings()" title="Settings">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button class="icon-btn" onclick="openAchievements()" title="Achievements">
                            <i class="fas fa-trophy"></i>
                        </button>
                        <button class="icon-btn" onclick="openStatistics()" title="Statistics">
                            <i class="fas fa-chart-bar"></i>
                        </button>
                        <button class="icon-btn" onclick="openMultiplayer()" title="Multiplayer">
                            <i class="fas fa-users"></i>
                        </button>
                    </div>
                </div>
                <h1 class="game-title">Quiz Master <span class="pro-badge">PRO</span></h1>
                <p class="game-subtitle">Ultimate Knowledge Challenge</p>
            </div>

            <div class="menu-content">
                <!-- Daily Challenge Banner -->
                <div class="daily-challenge-banner" id="daily-challenge">
                    <div class="challenge-icon">🎯</div>
                    <div class="challenge-content">
                        <h3>Daily Challenge</h3>
                        <p id="challenge-description">Science Speedrun - Answer 10 questions in under 2 minutes!</p>
                        <div class="challenge-reward">Reward: <span class="coins">100 <i class="fas fa-coins"></i></span></div>
                    </div>
                    <button class="challenge-btn" onclick="startDailyChallenge()">Start</button>
                </div>

                <!-- Enhanced User Stats -->
                <div class="user-stats">
                    <div class="stat-item">
                        <i class="fas fa-star"></i>
                        <span class="stat-label">Total Score</span>
                        <span class="stat-value" id="total-score">0</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-medal"></i>
                        <span class="stat-label">Levels Completed</span>
                        <span class="stat-value" id="levels-completed">0</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-coins"></i>
                        <span class="stat-label">Coins</span>
                        <span class="stat-value" id="user-coins">0</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-fire"></i>
                        <span class="stat-label">Streak</span>
                        <span class="stat-value" id="daily-streak">0</span>
                    </div>
                </div>

                <!-- Game Mode Selection -->
                <div class="game-modes">
                    <h3><i class="fas fa-gamepad"></i> Game Modes</h3>
                    <div class="modes-grid">
                        <button class="mode-card" onclick="selectMode('classic')" data-mode="classic">
                            <div class="mode-icon">📚</div>
                            <h4>Classic Mode</h4>
                            <p>Traditional quiz experience</p>
                        </button>
                        <button class="mode-card" onclick="selectMode('timeattack')" data-mode="timeattack">
                            <div class="mode-icon">⚡</div>
                            <h4>Time Attack</h4>
                            <p>Race against the clock</p>
                        </button>
                        <button class="mode-card" onclick="selectMode('survival')" data-mode="survival">
                            <div class="mode-icon">🔥</div>
                            <h4>Survival</h4>
                            <p>How long can you last?</p>
                        </button>
                        <button class="mode-card" onclick="selectMode('multiplayer')" data-mode="multiplayer">
                            <div class="mode-icon">👥</div>
                            <h4>Multiplayer</h4>
                            <p>Challenge friends</p>
                        </button>
                    </div>
                </div>

                <!-- Enhanced Sections Grid -->
                <div class="sections-container">
                    <h3><i class="fas fa-book"></i> Choose Your Category</h3>
                    <div class="sections-grid">
                        <div class="section-card" data-section="science">
                            <div class="section-header">
                                <div class="section-icon">🔬</div>
                                <div class="section-difficulty">
                                    <span class="difficulty-badge medium">Medium</span>
                                </div>
                            </div>
                            <h3>Science & Technology</h3>
                            <p>Explore the wonders of science and technology</p>
                            <div class="section-stats">
                                <div class="stat">
                                    <i class="fas fa-question-circle"></i>
                                    <span>75 Questions</span>
                                </div>
                                <div class="stat">
                                    <i class="fas fa-layer-group"></i>
                                    <span>5 Levels</span>
                                </div>
                            </div>
                            <div class="section-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                                <span class="progress-text">0/5 Levels</span>
                            </div>
                        </div>

                        <div class="section-card" data-section="history">
                            <div class="section-header">
                                <div class="section-icon">🏛️</div>
                                <div class="section-difficulty">
                                    <span class="difficulty-badge easy">Easy</span>
                                </div>
                            </div>
                            <h3>History & Geography</h3>
                            <p>Journey through time and explore the world</p>
                            <div class="section-stats">
                                <div class="stat">
                                    <i class="fas fa-question-circle"></i>
                                    <span>30 Questions</span>
                                </div>
                                <div class="stat">
                                    <i class="fas fa-layer-group"></i>
                                    <span>3 Levels</span>
                                </div>
                            </div>
                            <div class="section-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                                <span class="progress-text">0/3 Levels</span>
                            </div>
                        </div>

                        <div class="section-card" data-section="sports">
                            <div class="section-header">
                                <div class="section-icon">⚽</div>
                                <div class="section-difficulty">
                                    <span class="difficulty-badge easy">Easy</span>
                                </div>
                            </div>
                            <h3>Sports & Entertainment</h3>
                            <p>Challenge your sports and entertainment knowledge</p>
                            <div class="section-stats">
                                <div class="stat">
                                    <i class="fas fa-question-circle"></i>
                                    <span>20 Questions</span>
                                </div>
                                <div class="stat">
                                    <i class="fas fa-layer-group"></i>
                                    <span>2 Levels</span>
                                </div>
                            </div>
                            <div class="section-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                                <span class="progress-text">0/2 Levels</span>
                            </div>
                        </div>

                        <div class="section-card" data-section="literature">
                            <div class="section-header">
                                <div class="section-icon">📚</div>
                                <div class="section-difficulty">
                                    <span class="difficulty-badge medium">Medium</span>
                                </div>
                            </div>
                            <h3>Literature & Arts</h3>
                            <p>Dive into the world of books and creativity</p>
                            <div class="section-stats">
                                <div class="stat">
                                    <i class="fas fa-question-circle"></i>
                                    <span>20 Questions</span>
                                </div>
                                <div class="stat">
                                    <i class="fas fa-layer-group"></i>
                                    <span>2 Levels</span>
                                </div>
                            </div>
                            <div class="section-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                                <span class="progress-text">0/2 Levels</span>
                            </div>
                        </div>

                        <div class="section-card" data-section="general">
                            <div class="section-header">
                                <div class="section-icon">🧠</div>
                                <div class="section-difficulty">
                                    <span class="difficulty-badge easy">Easy</span>
                                </div>
                            </div>
                            <h3>General Knowledge</h3>
                            <p>Test your overall knowledge and trivia skills</p>
                            <div class="section-stats">
                                <div class="stat">
                                    <i class="fas fa-question-circle"></i>
                                    <span>20 Questions</span>
                                </div>
                                <div class="stat">
                                    <i class="fas fa-layer-group"></i>
                                    <span>2 Levels</span>
                                </div>
                            </div>
                            <div class="section-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                                <span class="progress-text">0/2 Levels</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Level Selection -->
        <div id="level-selection" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="showMainMenu()">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <h2 id="section-title">Choose Your Level</h2>
                <div class="section-info" id="section-info">
                    <span class="section-icon-small" id="section-icon">🔬</span>
                    <span id="section-description">Science & Technology</span>
                </div>
            </div>

            <div class="levels-grid" id="levels-grid">
                <!-- Levels will be populated by JavaScript -->
            </div>
        </div>

        <!-- Enhanced Quiz Game -->
        <div id="quiz-game" class="screen">
            <!-- Power-ups Bar -->
            <div class="powerups-bar">
                <button class="powerup-btn" id="fifty-fifty" onclick="usePowerUp('fiftyFifty')" title="50/50">
                    <i class="fas fa-divide"></i>
                    <span class="powerup-count">3</span>
                </button>
                <button class="powerup-btn" id="extra-time" onclick="usePowerUp('extraTime')" title="Extra Time">
                    <i class="fas fa-clock"></i>
                    <span class="powerup-count">2</span>
                </button>
                <button class="powerup-btn" id="skip-question" onclick="usePowerUp('skip')" title="Skip Question">
                    <i class="fas fa-forward"></i>
                    <span class="powerup-count">1</span>
                </button>
                <button class="powerup-btn" id="double-points" onclick="usePowerUp('doublePoints')" title="Double Points">
                    <i class="fas fa-gem"></i>
                    <span class="powerup-count">1</span>
                </button>
            </div>

            <div class="quiz-header">
                <div class="quiz-info">
                    <span class="question-counter">
                        Question <span id="current-question">1</span> of <span id="total-questions">10</span>
                    </span>
                    <div class="quiz-score">
                        Score: <span id="quiz-score">0</span>
                        <div class="multiplier" id="score-multiplier" style="display: none;">
                            x<span id="multiplier-value">2</span>
                        </div>
                    </div>
                </div>
                <div class="timer-container">
                    <div class="timer-circle">
                        <svg class="timer-svg" viewBox="0 0 100 100">
                            <circle class="timer-bg" cx="50" cy="50" r="45"/>
                            <circle class="timer-progress" cx="50" cy="50" r="45" id="timer-circle"/>
                        </svg>
                        <div class="timer-text" id="timer-text">30</div>
                    </div>
                </div>
            </div>

            <div class="question-container">
                <div class="question-card">
                    <div class="question-header">
                        <div class="difficulty-indicator" id="question-difficulty">
                            <i class="fas fa-star"></i>
                            <span>Medium</span>
                        </div>
                        <div class="question-category" id="question-category">Science</div>
                    </div>
                    <h3 class="question-text" id="question-text">Loading question...</h3>
                    <div class="answers-grid" id="answers-grid">
                        <!-- Answers will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <div class="quiz-footer">
                <button class="quiz-action-btn" id="quit-btn" onclick="quitQuiz()">
                    <i class="fas fa-times"></i> Quit
                </button>
                <div class="streak-indicator" id="streak-indicator" style="display: none;">
                    <i class="fas fa-fire"></i>
                    <span id="streak-count">0</span> Streak!
                </div>
                <button class="quiz-action-btn" id="hint-btn" onclick="showHint()" disabled>
                    <i class="fas fa-lightbulb"></i> Hint
                </button>
            </div>
        </div>

        <!-- Enhanced Results Screen -->
        <div id="results-screen" class="screen">
            <div class="results-container">
                <div class="results-header">
                    <div class="results-icon" id="results-icon">🎉</div>
                    <h2 id="results-title">Excellent Work!</h2>
                    <p id="results-subtitle">You've completed the quiz</p>
                </div>

                <div class="results-stats">
                    <div class="stat-card large">
                        <div class="stat-value" id="final-score">850</div>
                        <div class="stat-label">Final Score</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="correct-answers">8</div>
                        <div class="stat-label">Correct</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="accuracy-percentage">80%</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="time-taken">2:30</div>
                        <div class="stat-label">Time</div>
                    </div>
                </div>

                <div class="achievements-earned" id="achievements-earned" style="display: none;">
                    <h3><i class="fas fa-trophy"></i> Achievements Unlocked!</h3>
                    <div class="earned-achievements" id="earned-achievements">
                        <!-- Achievements will be populated -->
                    </div>
                </div>

                <div class="rewards-section">
                    <h3><i class="fas fa-gift"></i> Rewards Earned</h3>
                    <div class="rewards-grid">
                        <div class="reward-item">
                            <i class="fas fa-coins"></i>
                            <span id="coins-earned">+50 Coins</span>
                        </div>
                        <div class="reward-item">
                            <i class="fas fa-star"></i>
                            <span id="xp-earned">+100 XP</span>
                        </div>
                    </div>
                </div>

                <div class="social-sharing">
                    <h3><i class="fas fa-share-alt"></i> Share Your Score</h3>
                    <div class="share-buttons">
                        <button class="share-btn twitter" onclick="shareOnTwitter()">
                            <i class="fab fa-twitter"></i> Twitter
                        </button>
                        <button class="share-btn facebook" onclick="shareOnFacebook()">
                            <i class="fab fa-facebook"></i> Facebook
                        </button>
                        <button class="share-btn copy" onclick="copyScore()">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                </div>

                <div class="results-actions">
                    <button class="action-btn secondary" onclick="showMainMenu()">
                        <i class="fas fa-home"></i> Main Menu
                    </button>
                    <button class="action-btn primary" onclick="playAgain()">
                        <i class="fas fa-redo"></i> Play Again
                    </button>
                    <button class="action-btn success" onclick="nextLevel()">
                        <i class="fas fa-arrow-right"></i> Next Level
                    </button>
                </div>
            </div>
        </div>

        <!-- Achievement Notification -->
        <div id="achievement-notification" class="notification achievement-notification">
            <div class="notification-content">
                <div class="achievement-icon">🏆</div>
                <div class="achievement-info">
                    <h4 id="achievement-title">Achievement Unlocked!</h4>
                    <p id="achievement-description">First Steps - Complete your first quiz</p>
                </div>
            </div>
        </div>

        <!-- Powerup Notification -->
        <div id="powerup-notification" class="notification powerup-notification">
            <div class="notification-content">
                <div class="powerup-icon">⚡</div>
                <div class="powerup-info">
                    <h4 id="powerup-title">Power-up Activated!</h4>
                    <p id="powerup-description">50/50 - Two wrong answers removed</p>
                </div>
            </div>
        </div>

        <!-- Floating Particles -->
        <div class="particles-container" id="particles-container"></div>
    </div>

    <!-- Include all JavaScript files -->

    <!-- Core Data and Logic -->
    <script src="data/questions.js"></script>
    <script src="js/data-manager-enhanced.js"></script>
    <script src="js/game-logic-enhanced.js"></script>
    <script src="js/ui-manager-enhanced.js"></script>

    <!-- Premium Features - Phase 1: Basics -->
    <script src="js/audio-manager-fixed.js"></script>
    <script src="js/theme-manager.js"></script>
    <script src="js/achievements-system.js"></script>
    <script src="js/powerups-system.js"></script>
    <script src="js/daily-challenges.js"></script>

    <!-- Premium Features - Phase 2: Advanced -->
    <script src="js/statistics-manager.js"></script>
    <script src="js/time-attack-mode.js"></script>
    <script src="js/social-sharing.js"></script>

    <!-- Premium Features - Phase 3: Elite -->
    <script src="js/multiplayer-manager.js"></script>
    <script src="js/ai-adaptive-difficulty.js"></script>
    <script src="js/custom-quiz-creator.js"></script>
    <script src="js/voice-narration.js"></script>

    <!-- Visual Effects and Utilities -->
    <script src="js/particle-effects.js"></script>

    <!-- Debug and Integration Systems -->
    <script src="js/integration-fixer.js"></script>
    <script src="js/debug-test-suite.js"></script>
    <script src="js/compatibility-checker.js"></script>

    <!-- Main Application -->
    <script src="js/app-enhanced.js"></script>

    <!-- Enhanced Initialization -->
    <script>
        // Global initialization with all premium features
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎮 Quiz Master Pro with Premium Features initializing...');

            // Show loading progress
            const loadingText = document.querySelector('.loading-text');
            const loadingBar = document.querySelector('.loading-bar');

            const loadingSteps = [
                'Loading core systems...',
                'Initializing AI difficulty...',
                'Setting up multiplayer...',
                'Loading voice system...',
                'Running integration fixes...',
                'Preparing premium features...',
                'Almost ready...'
            ];

            let currentStep = 0;
            const updateLoading = () => {
                if (currentStep < loadingSteps.length) {
                    loadingText.textContent = loadingSteps[currentStep];
                    loadingBar.style.width = ((currentStep + 1) / loadingSteps.length * 100) + '%';
                    currentStep++;
                    setTimeout(updateLoading, 300);
                } else {
                    // All features loaded, hide loading screen
                    setTimeout(() => {
                        document.getElementById('loading-screen').classList.remove('active');

                        // Show welcome message for premium features
                        if (window.voiceNarrationSystem?.settings.enabled) {
                            setTimeout(() => {
                                window.voiceNarrationSystem.speak("Welcome to Quiz Master Pro! All premium features are now active.");
                            }, 1000);
                        }

                        // Show feature tour for first-time users
                        const isFirstTime = !localStorage.getItem('quiz-premium-tour-completed');
                        if (isFirstTime) {
                            setTimeout(showPremiumFeaturesTour, 2000);
                        }
                    }, 500);
                }
            };

            updateLoading();

            // Initialize integration fixes and debugging
            setTimeout(() => {
                if (window.IntegrationFixer) {
                    console.log('🔧 Running integration fixes...');
                    const fixer = new IntegrationFixer();
                    fixer.runAllFixes().then(() => {
                        console.log('✅ Integration fixes completed');

                        // Initialize debug test suite
                        if (window.DebugTestSuite) {
                            const debugSuite = new DebugTestSuite();
                            debugSuite.createDebugPanel();
                            console.log('🧪 Debug test suite initialized');
                        }
                    });
                }
            }, 1000);

            // Initialize enhanced keyboard shortcuts
            setupEnhancedKeyboardShortcuts();

            console.log('✅ Quiz Master Pro Premium Features Ready!');
        });

        function setupEnhancedKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Existing shortcuts
                if (e.key === 'Escape') {
                    const modals = document.querySelectorAll('.modal, .dialog');
                    modals.forEach(modal => modal.remove());
                }

                // Premium feature shortcuts
                if (e.ctrlKey) {
                    switch(e.key.toLowerCase()) {
                        case 'v': // Voice command
                            e.preventDefault();
                            if (window.voiceNarrationSystem) {
                                window.voiceNarrationSystem.isListening ?
                                    window.voiceNarrationSystem.stopListening() :
                                    window.voiceNarrationSystem.startListening();
                            }
                            break;
                        case 'm': // Multiplayer
                            e.preventDefault();
                            document.querySelector('.nav-btn[onclick="showMultiplayerPanel()"]')?.click();
                            break;
                        case 't': // Time Attack
                            e.preventDefault();
                            document.querySelector('.game-mode[data-mode="time-attack"]')?.click();
                            break;
                        case 'c': // Custom Quiz Creator
                            e.preventDefault();
                            document.querySelector('.create-new-quiz-btn')?.click();
                            break;
                        case 's': // Settings
                            e.preventDefault();
                            document.querySelector('.settings-btn')?.click();
                            break;
                    }
                }

                // Number keys for power-ups (1-7)
                if (e.key >= '1' && e.key <= '7' && !e.ctrlKey && !e.altKey) {
                    const powerUpIds = ['fiftyFifty', 'extraTime', 'skip', 'doublePoints', 'revealAnswer', 'freezeTime', 'perfectQuestion'];
                    const powerUpId = powerUpIds[parseInt(e.key) - 1];
                    if (powerUpId && window.powerUpsSystem) {
                        const button = document.getElementById(powerUpId);
                        if (button && !button.disabled) {
                            window.powerUpsSystem.usePowerUp(powerUpId);
                        }
                    }
                }
            });
        }

        function showPremiumFeaturesTour() {
            // Create a simple feature tour
            const tour = document.createElement('div');
            tour.className = 'feature-tour-modal';
            tour.innerHTML = `
                <div class="modal-overlay"></div>
                <div class="modal-content tour-content">
                    <div class="tour-header">
                        <h2>🌟 Welcome to Quiz Master Pro!</h2>
                        <p>Your quiz experience just got a major upgrade!</p>
                    </div>

                    <div class="tour-features">
                        <div class="feature-highlight">
                            <div class="feature-icon">🎤</div>
                            <h3>Voice Commands</h3>
                            <p>Say "A", "B", "C", or "D" to answer questions hands-free!</p>
                        </div>

                        <div class="feature-highlight">
                            <div class="feature-icon">🤖</div>
                            <h3>AI Adaptive Difficulty</h3>
                            <p>Questions automatically adjust to your skill level</p>
                        </div>

                        <div class="feature-highlight">
                            <div class="feature-icon">⚔️</div>
                            <h3>Multiplayer Battles</h3>
                            <p>Challenge friends in real-time quiz competitions</p>
                        </div>

                        <div class="feature-highlight">
                            <div class="feature-icon">⚡</div>
                            <h3>Time Attack Mode</h3>
                            <p>Fast-paced quiz mode with score multipliers</p>
                        </div>

                        <div class="feature-highlight">
                            <div class="feature-icon">🏆</div>
                            <h3>Achievements & Rewards</h3>
                            <p>Unlock achievements and earn power-ups</p>
                        </div>

                        <div class="feature-highlight">
                            <div class="feature-icon">🎨</div>
                            <h3>Custom Quiz Creator</h3>
                            <p>Create and share your own quiz questions</p>
                        </div>
                    </div>

                    <div class="tour-footer">
                        <label class="tour-checkbox">
                            <input type="checkbox" id="dont-show-again"> Don't show this again
                        </label>
                        <button class="btn-primary start-playing-btn">Start Playing!</button>
                    </div>
                </div>
            `;

            document.body.appendChild(tour);

            tour.querySelector('.start-playing-btn').onclick = () => {
                if (tour.querySelector('#dont-show-again').checked) {
                    localStorage.setItem('quiz-premium-tour-completed', 'true');
                }
                tour.remove();
            };
        }
    </script>
</body>
</html>