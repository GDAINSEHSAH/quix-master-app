<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sound Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”Š Sound Effects Debug Test</h1>
        <p>This page will test if the audio system actually works on your browser.</p>

        <div id="browser-info" class="status warning">
            <strong>Browser Info:</strong> <span id="browser-details"></span>
        </div>

        <div id="audio-support" class="status">
            <strong>Audio Support:</strong> <span id="support-details"></span>
        </div>

        <h2>Manual Tests</h2>
        <button onclick="testBasicBeep()">ğŸ”Š Test Basic Beep</button>
        <button onclick="testWebAudio()">ğŸµ Test Web Audio API</button>
        <button onclick="testCorrectSound()">âœ… Test Correct Sound</button>
        <button onclick="testWrongSound()">âŒ Test Wrong Sound</button>
        <button onclick="testPowerupSound()">âš¡ Test Power-up Sound</button>
        <button onclick="clearLog()">ğŸ—‘ï¸ Clear Log</button>

        <h2>Debug Log</h2>
        <div id="debug-log" class="log">Initializing audio debug test...\n</div>

        <h2>Live Quiz Test</h2>
        <div id="quiz-test">
            <p><strong>What is 2 + 2?</strong></p>
            <button onclick="answerQuestion(true)">4 (Correct)</button>
            <button onclick="answerQuestion(false)">5 (Wrong)</button>
        </div>
    </div>

    <script>
        let audioManager = null;
        let audioContext = null;

        function log(message) {
            const logEl = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('debug-log').textContent = '';
        }

        function updateStatus(elementId, message, type = 'info') {
            const el = document.getElementById(elementId);
            el.className = `status ${type}`;
            el.querySelector('span').textContent = message;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Browser info
            const browserInfo = {
                userAgent: navigator.userAgent,
                audioContext: !!(window.AudioContext || window.webkitAudioContext),
                webAudio: 'createOscillator' in (new (window.AudioContext || window.webkitAudioContext)()),
            };

            document.getElementById('browser-details').textContent =
                `${navigator.userAgent.split(' ').slice(-2).join(' ')}`;

            if (browserInfo.audioContext) {
                updateStatus('audio-support', 'Web Audio API supported âœ…', 'success');
            } else {
                updateStatus('audio-support', 'Web Audio API NOT supported âŒ', 'error');
            }

            log('ğŸ” Browser detection complete');
            log(`Audio Context: ${browserInfo.audioContext ? 'Available' : 'Not available'}`);

            initializeAudio();
        });

        function initializeAudio() {
            try {
                // Try to create audio context
                const AudioContextClass = window.AudioContext || window.webkitAudioContext;
                if (AudioContextClass) {
                    audioContext = new AudioContextClass();
                    log(`âœ… Audio Context created: ${audioContext.state}`);
                } else {
                    log('âŒ Audio Context not available');
                    return;
                }

                // Initialize the actual audio manager
                initializeAudioManager();

            } catch (error) {
                log(`âŒ Audio initialization failed: ${error.message}`);
            }
        }

        function initializeAudioManager() {
            // Simplified AudioManager for testing
            audioManager = {
                audioContext: audioContext,
                settings: {
                    soundEffects: true,
                    volume: 0.7
                },

                playBeep: function(frequency = 440, duration = 0.2) {
                    try {
                        if (this.audioContext.state === 'suspended') {
                            this.audioContext.resume();
                        }

                        const oscillator = this.audioContext.createOscillator();
                        const gainNode = this.audioContext.createGain();

                        oscillator.connect(gainNode);
                        gainNode.connect(this.audioContext.destination);

                        oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                        oscillator.type = 'sine';

                        gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                        gainNode.gain.linearRampToValueAtTime(this.settings.volume * 0.3, this.audioContext.currentTime + 0.01);
                        gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);

                        oscillator.start();
                        oscillator.stop(this.audioContext.currentTime + duration);

                        log(`ğŸ”Š Played beep: ${frequency}Hz for ${duration}s`);
                        return true;
                    } catch (error) {
                        log(`âŒ Beep failed: ${error.message}`);
                        return false;
                    }
                },

                playCorrect: function() {
                    // Play ascending chord
                    this.playBeep(523.25, 0.1); // C5
                    setTimeout(() => this.playBeep(659.25, 0.1), 100); // E5
                    setTimeout(() => this.playBeep(783.99, 0.2), 200); // G5
                },

                playWrong: function() {
                    // Play descending notes
                    this.playBeep(220, 0.2); // A3
                    setTimeout(() => this.playBeep(185, 0.2), 200); // F#3
                },

                playPowerup: function() {
                    // Play ascending scale
                    const notes = [440, 554.37, 659.25, 880];
                    notes.forEach((freq, i) => {
                        setTimeout(() => this.playBeep(freq, 0.1), i * 100);
                    });
                }
            };

            log('âœ… Simplified AudioManager initialized');
        }

        function testBasicBeep() {
            log('ğŸ§ª Testing basic beep...');
            if (audioManager) {
                const result = audioManager.playBeep(440, 0.5);
                if (result) {
                    log('âœ… Basic beep test passed');
                } else {
                    log('âŒ Basic beep test failed');
                }
            } else {
                log('âŒ AudioManager not initialized');
            }
        }

        function testWebAudio() {
            log('ğŸ§ª Testing Web Audio API directly...');
            try {
                if (audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        log('âœ… Audio context resumed');
                        playDirectBeep();
                    });
                } else {
                    playDirectBeep();
                }
            } catch (error) {
                log(`âŒ Web Audio test failed: ${error.message}`);
            }
        }

        function playDirectBeep() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = 800;
            oscillator.type = 'sine';

            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3);

            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.3);

            log('âœ… Direct Web Audio test completed');
        }

        function testCorrectSound() {
            log('ğŸ§ª Testing correct answer sound...');
            if (audioManager) {
                audioManager.playCorrect();
                log('âœ… Correct sound triggered');
            } else {
                log('âŒ AudioManager not available');
            }
        }

        function testWrongSound() {
            log('ğŸ§ª Testing wrong answer sound...');
            if (audioManager) {
                audioManager.playWrong();
                log('âœ… Wrong sound triggered');
            } else {
                log('âŒ AudioManager not available');
            }
        }

        function testPowerupSound() {
            log('ğŸ§ª Testing power-up sound...');
            if (audioManager) {
                audioManager.playPowerup();
                log('âœ… Power-up sound triggered');
            } else {
                log('âŒ AudioManager not available');
            }
        }

        function answerQuestion(isCorrect) {
            log(`ğŸ¯ Quiz answer: ${isCorrect ? 'Correct' : 'Wrong'}`);
            if (isCorrect) {
                testCorrectSound();
            } else {
                testWrongSound();
            }
        }

        // User interaction required for audio context
        document.addEventListener('click', function() {
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume().then(() => {
                    log('ğŸ”“ Audio context activated by user interaction');
                });
            }
        }, { once: true });

        log('ğŸš€ Sound debug test ready');
    </script>
</body>
</html>