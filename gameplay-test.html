<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Gameplay Testing - Quiz Master</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        h1 { text-align: center; margin-bottom: 30px; }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #00ff88;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
        }
        .pass { background: rgba(0, 255, 136, 0.2); }
        .fail { background: rgba(255, 0, 68, 0.2); }
        .warn { background: rgba(255, 193, 7, 0.2); }
        .info { background: rgba(0, 123, 255, 0.2); }
        button {
            background: linear-gradient(45deg, #00ff88, #00d4ff);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #00ff88;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
            border-radius: 10px;
            background: white;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Live Quiz Master App Testing</h1>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="total-tests">0</div>
                <div>Total Tests</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="passed-tests">0</div>
                <div>Passed</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="failed-tests">0</div>
                <div>Failed</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="test-score">0%</div>
                <div>Success Rate</div>
            </div>
        </div>

        <div class="test-section">
            <h2>üéØ Automated Testing Controls</h2>
            <button onclick="runBasicTests()">Run Basic Tests</button>
            <button onclick="runGameplayTests()">Test Gameplay Flow</button>
            <button onclick="runStressTests()">Stress Testing</button>
            <button onclick="testAllSections()">Test All Sections</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>

        <div class="test-section">
            <h2>üì± App Preview</h2>
            <iframe id="app-frame" src="https://gdainsehsah.github.io/quix-master-app"></iframe>
        </div>

        <div class="test-section">
            <h2>üìä Test Results</h2>
            <div id="test-results"></div>
        </div>

        <div class="test-section">
            <h2>üêõ Issues Found</h2>
            <div id="issues-found"></div>
        </div>
    </div>

    <script>
        let testResults = [];
        let issuesFound = [];

        function logTest(name, status, details = '') {
            const result = { name, status, details, timestamp: new Date().toISOString() };
            testResults.push(result);

            const resultsDiv = document.getElementById('test-results');
            const resultElement = document.createElement('div');
            resultElement.className = `test-result ${status}`;
            resultElement.innerHTML = `
                <strong>${status.toUpperCase()}: ${name}</strong>
                ${details ? `<br><small>${details}</small>` : ''}
                <small style="float: right;">${new Date().toLocaleTimeString()}</small>
            `;
            resultsDiv.appendChild(resultElement);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;

            updateStats();
        }

        function logIssue(severity, description, section = '') {
            const issue = { severity, description, section, timestamp: new Date().toISOString() };
            issuesFound.push(issue);

            const issuesDiv = document.getElementById('issues-found');
            const issueElement = document.createElement('div');
            issueElement.className = `test-result ${severity}`;
            issueElement.innerHTML = `
                <strong>${severity.toUpperCase()}: ${description}</strong>
                ${section ? `<br><small>Section: ${section}</small>` : ''}
                <small style="float: right;">${new Date().toLocaleTimeString()}</small>
            `;
            issuesDiv.appendChild(issueElement);
        }

        function updateStats() {
            const total = testResults.length;
            const passed = testResults.filter(r => r.status === 'pass').length;
            const failed = testResults.filter(r => r.status === 'fail').length;
            const score = total > 0 ? Math.round((passed / total) * 100) : 0;

            document.getElementById('total-tests').textContent = total;
            document.getElementById('passed-tests').textContent = passed;
            document.getElementById('failed-tests').textContent = failed;
            document.getElementById('test-score').textContent = score + '%';
        }

        function clearResults() {
            testResults = [];
            issuesFound = [];
            document.getElementById('test-results').innerHTML = '';
            document.getElementById('issues-found').innerHTML = '';
            updateStats();
            logTest('Test Results Cleared', 'info');
        }

        async function runBasicTests() {
            logTest('Starting Basic Tests', 'info');

            // Test 1: Check if app loads
            try {
                const frame = document.getElementById('app-frame');
                const response = await fetch('https://gdainsehsah.github.io/quix-master-app');

                if (response.ok) {
                    logTest('App URL Accessibility', 'pass', 'App URL returns 200 OK');
                } else {
                    logTest('App URL Accessibility', 'fail', `Status: ${response.status}`);
                    logIssue('fail', 'App URL not accessible', 'Network');
                }
            } catch (error) {
                logTest('App URL Accessibility', 'fail', error.message);
                logIssue('fail', 'Network error accessing app', 'Network');
            }

            // Test 2: Check key resources
            const resources = [
                'https://gdainsehsah.github.io/quix-master-app/css/style.css',
                'https://gdainsehsah.github.io/quix-master-app/data/questions.js',
                'https://gdainsehsah.github.io/quix-master-app/js/data-manager.js',
                'https://gdainsehsah.github.io/quix-master-app/js/game-logic.js'
            ];

            for (const resource of resources) {
                try {
                    const response = await fetch(resource);
                    const fileName = resource.split('/').pop();

                    if (response.ok) {
                        logTest(`Resource: ${fileName}`, 'pass', 'File accessible');
                    } else {
                        logTest(`Resource: ${fileName}`, 'fail', `Status: ${response.status}`);
                        logIssue('fail', `Missing resource: ${fileName}`, 'Resources');
                    }
                } catch (error) {
                    logTest(`Resource: ${resource.split('/').pop()}`, 'fail', error.message);
                    logIssue('fail', `Failed to load: ${resource.split('/').pop()}`, 'Resources');
                }
            }

            logTest('Basic Tests Completed', 'info');
        }

        async function runGameplayTests() {
            logTest('Starting Gameplay Tests', 'info');

            // These tests would need to be run within the app's context
            // For now, we'll test what we can from outside

            // Test iframe communication
            try {
                const frame = document.getElementById('app-frame');

                // Wait for frame to load
                await new Promise((resolve) => {
                    if (frame.contentWindow) {
                        resolve();
                    } else {
                        frame.onload = resolve;
                    }
                });

                logTest('App Frame Loading', 'pass', 'Iframe loaded successfully');

                // Test if we can access the frame content (may be blocked by CORS)
                try {
                    const frameDoc = frame.contentWindow.document;
                    if (frameDoc && frameDoc.title) {
                        logTest('App Content Access', 'pass', `Title: ${frameDoc.title}`);
                    } else {
                        logTest('App Content Access', 'warn', 'Limited access due to CORS policy');
                    }
                } catch (error) {
                    logTest('App Content Access', 'warn', 'CORS policy prevents direct access');
                }

            } catch (error) {
                logTest('App Frame Loading', 'fail', error.message);
                logIssue('fail', 'App frame failed to load', 'UI');
            }

            logTest('Gameplay Tests Completed', 'info');
        }

        async function runStressTests() {
            logTest('Starting Stress Tests', 'info');

            // Test 1: Multiple rapid requests
            const startTime = performance.now();
            const promises = [];

            for (let i = 0; i < 10; i++) {
                promises.push(fetch('https://gdainsehsah.github.io/quix-master-app'));
            }

            try {
                const responses = await Promise.all(promises);
                const endTime = performance.now();
                const avgTime = (endTime - startTime) / responses.length;

                const successCount = responses.filter(r => r.ok).length;

                if (successCount === 10) {
                    logTest('Concurrent Request Handling', 'pass',
                           `10/10 requests successful, avg: ${avgTime.toFixed(2)}ms`);
                } else {
                    logTest('Concurrent Request Handling', 'fail',
                           `${successCount}/10 requests successful`);
                    logIssue('warn', 'Some concurrent requests failed', 'Performance');
                }
            } catch (error) {
                logTest('Concurrent Request Handling', 'fail', error.message);
                logIssue('fail', 'Concurrent request test failed', 'Performance');
            }

            // Test 2: Memory usage monitoring
            if (performance.memory) {
                const memBefore = performance.memory.usedJSHeapSize;

                // Simulate memory-intensive operation
                const largeArray = new Array(100000).fill('test');

                const memAfter = performance.memory.usedJSHeapSize;
                const memIncrease = (memAfter - memBefore) / 1024 / 1024;

                if (memIncrease < 50) {
                    logTest('Memory Usage', 'pass', `Memory increase: ${memIncrease.toFixed(2)}MB`);
                } else {
                    logTest('Memory Usage', 'warn', `High memory increase: ${memIncrease.toFixed(2)}MB`);
                    logIssue('warn', 'High memory usage detected', 'Performance');
                }
            } else {
                logTest('Memory Usage', 'warn', 'Memory API not available');
            }

            logTest('Stress Tests Completed', 'info');
        }

        async function testAllSections() {
            logTest('Testing All Quiz Sections', 'info');

            // Test questions.js accessibility and structure
            try {
                const response = await fetch('https://gdainsehsah.github.io/quix-master-app/data/questions.js');
                const content = await response.text();

                // Basic validation of questions.js structure
                if (content.includes('QUIZ_DATABASE')) {
                    logTest('Questions Database Structure', 'pass', 'QUIZ_DATABASE found');

                    // Check for main sections
                    const sections = ['science', 'history', 'sports', 'literature', 'general'];
                    let sectionsFound = 0;

                    sections.forEach(section => {
                        if (content.includes(`${section}:`)) {
                            sectionsFound++;
                        }
                    });

                    if (sectionsFound === 5) {
                        logTest('Quiz Sections', 'pass', 'All 5 sections found');
                    } else {
                        logTest('Quiz Sections', 'fail', `Only ${sectionsFound}/5 sections found`);
                        logIssue('fail', 'Missing quiz sections', 'Database');
                    }

                    // Check for levels structure
                    if (content.includes('levels:') && content.includes('question:')) {
                        logTest('Questions Structure', 'pass', 'Question structure appears valid');
                    } else {
                        logTest('Questions Structure', 'fail', 'Invalid question structure');
                        logIssue('fail', 'Invalid question database structure', 'Database');
                    }

                } else {
                    logTest('Questions Database Structure', 'fail', 'QUIZ_DATABASE not found');
                    logIssue('fail', 'Questions database malformed', 'Database');
                }

            } catch (error) {
                logTest('Questions Database Access', 'fail', error.message);
                logIssue('fail', 'Cannot access questions database', 'Database');
            }

            logTest('All Sections Test Completed', 'info');
        }

        // Auto-run basic tests on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                logTest('Automated Testing Started', 'info', 'Testing live app functionality');
                runBasicTests();
            }, 2000);
        });
    </script>
</body>
</html>