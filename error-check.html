<!DOCTYPE html>
<html>
<head>
    <title>Error Check</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #000;
            color: #0f0;
        }
        .error { color: #f00; }
        .success { color: #0f0; }
        .warning { color: #ff0; }
    </style>
</head>
<body>
    <h1>üîç Error Detection</h1>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');

        function log(message, type = 'normal') {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(div);
            console.log(message);
        }

        // Capture all errors
        window.addEventListener('error', function(e) {
            log(`‚ùå ERROR: ${e.message} at ${e.filename}:${e.lineno}`, 'error');
        });

        window.addEventListener('unhandledrejection', function(e) {
            log(`‚ùå PROMISE REJECTION: ${e.reason}`, 'error');
        });

        log('üöÄ Error checker started');

        // Test 1: Try to load the main app content
        log('üì° Testing main app fetch...');
        fetch('https://gdainsehsah.github.io/quix-master-app/')
            .then(response => {
                log(`‚úÖ Main app fetch: ${response.status} ${response.statusText}`, 'success');
                return response.text();
            })
            .then(html => {
                log(`‚úÖ Main app HTML loaded: ${html.length} characters`, 'success');

                // Check for error indicators in HTML
                if (html.includes('404') || html.includes('Not Found')) {
                    log('‚ùå 404 error detected in HTML', 'error');
                } else if (html.includes('500') || html.includes('Server Error')) {
                    log('‚ùå Server error detected in HTML', 'error');
                } else {
                    log('‚úÖ No obvious error messages in HTML', 'success');
                }

                // Test loading individual JS files
                testJSFiles();
            })
            .catch(error => {
                log(`‚ùå Main app fetch failed: ${error.message}`, 'error');
            });

        function testJSFiles() {
            log('üìú Testing individual JavaScript files...');

            const jsFiles = [
                'js/audio-manager-fixed.js',
                'js/data-manager-enhanced.js',
                'js/app-enhanced.js'
            ];

            jsFiles.forEach(file => {
                fetch(`https://gdainsehsah.github.io/quix-master-app/${file}`)
                    .then(response => {
                        if (response.ok) {
                            log(`‚úÖ ${file}: OK`, 'success');
                            return response.text();
                        } else {
                            log(`‚ùå ${file}: HTTP ${response.status}`, 'error');
                        }
                    })
                    .then(content => {
                        if (content) {
                            // Check for syntax errors
                            try {
                                new Function(content);
                                log(`‚úÖ ${file}: Syntax OK`, 'success');
                            } catch (syntaxError) {
                                log(`‚ùå ${file}: Syntax error - ${syntaxError.message}`, 'error');
                            }
                        }
                    })
                    .catch(error => {
                        log(`‚ùå ${file}: Load failed - ${error.message}`, 'error');
                    });
            });
        }

        // Test 2: Create iframe to see actual behavior
        log('üñºÔ∏è Creating iframe test...');
        setTimeout(() => {
            const iframe = document.createElement('iframe');
            iframe.src = 'https://gdainsehsah.github.io/quix-master-app/';
            iframe.style.width = '800px';
            iframe.style.height = '400px';
            iframe.style.border = '2px solid #0f0';
            iframe.style.margin = '20px 0';

            iframe.onload = function() {
                log('‚úÖ Iframe loaded successfully', 'success');

                setTimeout(() => {
                    try {
                        const doc = iframe.contentDocument;
                        if (doc) {
                            const bodyText = doc.body.textContent;
                            if (bodyText.includes('something went wrong')) {
                                log('üö® FOUND IT: "something went wrong" message in iframe', 'error');
                                log(`Content: ${bodyText.substring(0, 200)}...`, 'warning');
                            } else {
                                log('‚úÖ No "something went wrong" message found', 'success');
                            }
                        } else {
                            log('‚ö†Ô∏è Cannot access iframe content (CORS)', 'warning');
                        }
                    } catch (e) {
                        log(`‚ö†Ô∏è Iframe inspection failed: ${e.message}`, 'warning');
                    }
                }, 2000);
            };

            iframe.onerror = function() {
                log('‚ùå Iframe failed to load', 'error');
            };

            output.appendChild(iframe);
        }, 3000);

        // Test 3: Browser environment
        log(`üåç Browser: ${navigator.userAgent}`);
        log(`üîä Audio Context: ${!!(window.AudioContext || window.webkitAudioContext)}`, 'success');
        log(`üíæ Local Storage: ${!!window.localStorage}`, 'success');
        log(`üåê Fetch API: ${!!window.fetch}`, 'success');

        // Final summary
        setTimeout(() => {
            log('\nüìä SUMMARY:', 'warning');
            log('If you see "something went wrong" above, that\'s the issue.', 'warning');
            log('If iframe loads but shows errors, check browser console (F12).', 'warning');
            log('All tests complete.', 'success');
        }, 10000);
    </script>
</body>
</html>