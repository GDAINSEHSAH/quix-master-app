<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Test Suite - Quiz Master</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            min-height: 100vh;
        }
        .test-suite {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        h1 { text-align: center; margin-bottom: 30px; font-size: 2.5em; }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .test-panel {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .test-title {
            font-size: 1.2em;
            font-weight: bold;
        }
        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .status-pending { background: #ffc107; color: #000; }
        .status-running { background: #17a2b8; color: #fff; }
        .status-success { background: #28a745; color: #fff; }
        .status-error { background: #dc3545; color: #fff; }
        .status-warning { background: #fd7e14; color: #fff; }
        .test-log {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s ease;
        }
        .summary-panel {
            grid-column: 1 / -1;
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.3);
        }
        .metric {
            display: inline-block;
            margin: 0 15px;
            text-align: center;
        }
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }
        .metric-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        .iframe-test {
            width: 100%;
            height: 400px;
            border: none;
            border-radius: 10px;
            background: white;
        }
    </style>
</head>
<body>
    <div class="test-suite">
        <h1>üß™ Advanced Test Suite</h1>
        <p style="text-align: center; margin-bottom: 30px; opacity: 0.9;">
            Comprehensive testing of Quiz Master Pro - Main App vs Working Version
        </p>

        <div class="controls">
            <button onclick="runAllTests()" id="run-all-btn">üöÄ Run All Tests</button>
            <button onclick="clearAllLogs()">üóëÔ∏è Clear Logs</button>
            <button onclick="exportResults()">üìã Export Results</button>
            <button onclick="window.open('https://gdainsehsah.github.io/quix-master-app/', '_blank')">
                üîó Open Main App
            </button>
        </div>

        <div class="test-panel summary-panel">
            <div class="test-header">
                <h2>üìä Test Summary</h2>
                <span id="overall-status" class="status-badge status-pending">Pending</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="overall-progress"></div>
            </div>
            <div style="text-align: center; margin: 20px 0;">
                <div class="metric">
                    <span class="metric-value" id="tests-passed">0</span>
                    <span class="metric-label">Passed</span>
                </div>
                <div class="metric">
                    <span class="metric-value" id="tests-failed">0</span>
                    <span class="metric-label">Failed</span>
                </div>
                <div class="metric">
                    <span class="metric-value" id="tests-total">0</span>
                    <span class="metric-label">Total</span>
                </div>
                <div class="metric">
                    <span class="metric-value" id="success-rate">0%</span>
                    <span class="metric-label">Success Rate</span>
                </div>
            </div>
            <div class="test-log" id="summary-log">Test summary will appear here...</div>
        </div>

        <div class="test-grid">
            <!-- Network Connectivity Test -->
            <div class="test-panel">
                <div class="test-header">
                    <div class="test-title">üåê Network & Connectivity</div>
                    <span id="network-status" class="status-badge status-pending">Pending</span>
                </div>
                <button onclick="runNetworkTest()" id="network-btn">Test Network</button>
                <div class="test-log" id="network-log">Network test log...</div>
            </div>

            <!-- File Loading Test -->
            <div class="test-panel">
                <div class="test-header">
                    <div class="test-title">üìÅ File Loading</div>
                    <span id="files-status" class="status-badge status-pending">Pending</span>
                </div>
                <button onclick="runFileTest()" id="files-btn">Test Files</button>
                <div class="test-log" id="files-log">File loading test log...</div>
            </div>

            <!-- JavaScript Execution Test -->
            <div class="test-panel">
                <div class="test-header">
                    <div class="test-title">üìú JavaScript Execution</div>
                    <span id="js-status" class="status-badge status-pending">Pending</span>
                </div>
                <button onclick="runJSTest()" id="js-btn">Test JavaScript</button>
                <div class="test-log" id="js-log">JavaScript execution test log...</div>
            </div>

            <!-- Audio System Test -->
            <div class="test-panel">
                <div class="test-header">
                    <div class="test-title">üîä Audio System</div>
                    <span id="audio-status" class="status-badge status-pending">Pending</span>
                </div>
                <button onclick="runAudioTest()" id="audio-btn">Test Audio</button>
                <div class="test-log" id="audio-log">Audio system test log...</div>
            </div>

            <!-- UI Rendering Test -->
            <div class="test-panel">
                <div class="test-header">
                    <div class="test-title">üé® UI Rendering</div>
                    <span id="ui-status" class="status-badge status-pending">Pending</span>
                </div>
                <button onclick="runUITest()" id="ui-btn">Test UI</button>
                <div class="test-log" id="ui-log">UI rendering test log...</div>
            </div>

            <!-- Performance Test -->
            <div class="test-panel">
                <div class="test-header">
                    <div class="test-title">‚ö° Performance</div>
                    <span id="perf-status" class="status-badge status-pending">Pending</span>
                </div>
                <button onclick="runPerfTest()" id="perf-btn">Test Performance</button>
                <div class="test-log" id="perf-log">Performance test log...</div>
            </div>

            <!-- Browser Compatibility Test -->
            <div class="test-panel">
                <div class="test-header">
                    <div class="test-title">üåç Browser Compatibility</div>
                    <span id="browser-status" class="status-badge status-pending">Pending</span>
                </div>
                <button onclick="runBrowserTest()" id="browser-btn">Test Browser</button>
                <div class="test-log" id="browser-log">Browser compatibility test log...</div>
            </div>

            <!-- Main App Live Test -->
            <div class="test-panel">
                <div class="test-header">
                    <div class="test-title">üéØ Main App Live Test</div>
                    <span id="live-status" class="status-badge status-pending">Pending</span>
                </div>
                <button onclick="runLiveTest()" id="live-btn">Test Live App</button>
                <div class="test-log" id="live-log">Live app test log...</div>
            </div>
        </div>

        <!-- Embedded App Test -->
        <div class="test-panel">
            <div class="test-header">
                <h3>üñºÔ∏è Embedded Main App Test</h3>
                <span id="embed-status" class="status-badge status-pending">Loading...</span>
            </div>
            <p>This will load the main app in an iframe to test if it loads without errors:</p>
            <iframe id="main-app-iframe" class="iframe-test"
                    src="https://gdainsehsah.github.io/quiz-master-app/"
                    onload="onIframeLoad()"
                    onerror="onIframeError()">
            </iframe>
            <div class="test-log" id="embed-log">Iframe loading...</div>
        </div>
    </div>

    <script>
        const BASE_URL = 'https://gdainsehsah.github.io/quiz-master-app';

        let testResults = {
            network: null,
            files: null,
            js: null,
            audio: null,
            ui: null,
            perf: null,
            browser: null,
            live: null
        };

        let totalTests = 0;
        let completedTests = 0;

        function log(testName, message) {
            const logEl = document.getElementById(`${testName}-log`);
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(`[${testName}] ${message}`);
        }

        function setStatus(testName, status, message = '') {
            const statusEl = document.getElementById(`${testName}-status`);
            statusEl.className = `status-badge status-${status}`;
            statusEl.textContent = message || status.charAt(0).toUpperCase() + status.slice(1);
        }

        function clearAllLogs() {
            Object.keys(testResults).forEach(test => {
                document.getElementById(`${test}-log`).textContent = '';
                setStatus(test, 'pending');
            });
            document.getElementById('summary-log').textContent = 'Logs cleared...';
            document.getElementById('embed-log').textContent = '';
            updateSummary();
        }

        function updateSummary() {
            const results = Object.values(testResults).filter(r => r !== null);
            const passed = results.filter(r => r === true).length;
            const failed = results.filter(r => r === false).length;
            const total = results.length;
            const successRate = total > 0 ? Math.round((passed / total) * 100) : 0;

            document.getElementById('tests-passed').textContent = passed;
            document.getElementById('tests-failed').textContent = failed;
            document.getElementById('tests-total').textContent = total;
            document.getElementById('success-rate').textContent = successRate + '%';

            const progress = total > 0 ? (total / Object.keys(testResults).length) * 100 : 0;
            document.getElementById('overall-progress').style.width = progress + '%';

            if (total === Object.keys(testResults).length) {
                if (successRate >= 90) {
                    setStatus('overall', 'success', 'Excellent');
                } else if (successRate >= 70) {
                    setStatus('overall', 'warning', 'Good');
                } else {
                    setStatus('overall', 'error', 'Issues Found');
                }
            }
        }

        async function runNetworkTest() {
            log('network', 'üåê Testing network connectivity...');
            setStatus('network', 'running');

            try {
                const start = performance.now();
                const response = await fetch(BASE_URL, { method: 'HEAD' });
                const end = performance.now();
                const loadTime = Math.round(end - start);

                if (response.ok) {
                    log('network', `‚úÖ Main app accessible (${loadTime}ms)`);
                    log('network', `Status: ${response.status} ${response.statusText}`);
                    log('network', `Server: ${response.headers.get('server')}`);
                    log('network', `Content-Type: ${response.headers.get('content-type')}`);

                    setStatus('network', 'success', `${loadTime}ms`);
                    testResults.network = true;
                } else {
                    log('network', `‚ùå HTTP error: ${response.status}`);
                    setStatus('network', 'error', `HTTP ${response.status}`);
                    testResults.network = false;
                }
            } catch (error) {
                log('network', `‚ùå Network error: ${error.message}`);
                setStatus('network', 'error', 'Network failed');
                testResults.network = false;
            }

            updateSummary();
        }

        async function runFileTest() {
            log('files', 'üìÅ Testing file loading...');
            setStatus('files', 'running');

            const criticalFiles = [
                'css/style-enhanced.css',
                'js/audio-manager-fixed.js',
                'js/data-manager-enhanced.js',
                'js/game-logic-enhanced.js',
                'js/ui-manager-enhanced.js',
                'js/app-enhanced.js',
                'data/questions.js',
                'manifest.json'
            ];

            let loadedFiles = 0;
            let totalSize = 0;

            for (const file of criticalFiles) {
                try {
                    const response = await fetch(`${BASE_URL}/${file}`);
                    if (response.ok) {
                        const content = await response.text();
                        totalSize += content.length;
                        log('files', `‚úÖ ${file} (${content.length} bytes)`);
                        loadedFiles++;
                    } else {
                        log('files', `‚ùå ${file} - HTTP ${response.status}`);
                    }
                } catch (error) {
                    log('files', `‚ùå ${file} - ${error.message}`);
                }
            }

            log('files', `üìä Loaded ${loadedFiles}/${criticalFiles.length} files (${totalSize} total bytes)`);

            if (loadedFiles === criticalFiles.length) {
                setStatus('files', 'success', `${loadedFiles}/${criticalFiles.length}`);
                testResults.files = true;
            } else {
                setStatus('files', 'error', `${loadedFiles}/${criticalFiles.length}`);
                testResults.files = false;
            }

            updateSummary();
        }

        async function runJSTest() {
            log('js', 'üìú Testing JavaScript execution...');
            setStatus('js', 'running');

            try {
                // Test basic JavaScript features
                log('js', '‚úÖ Basic JavaScript: OK');

                // Test ES6 features
                const testArrow = () => 'arrow function works';
                const testDestructuring = { a: 1, b: 2 };
                const { a, b } = testDestructuring;
                log('js', '‚úÖ ES6 features: OK');

                // Test async/await
                await new Promise(resolve => setTimeout(resolve, 100));
                log('js', '‚úÖ Async/await: OK');

                // Test fetch API
                if (typeof fetch === 'function') {
                    log('js', '‚úÖ Fetch API: Available');
                } else {
                    log('js', '‚ùå Fetch API: Not available');
                }

                // Test local storage
                try {
                    localStorage.setItem('test', 'test');
                    localStorage.removeItem('test');
                    log('js', '‚úÖ LocalStorage: Available');
                } catch (e) {
                    log('js', '‚ùå LocalStorage: Not available');
                }

                // Test audio context
                try {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    if (AudioContext) {
                        const ctx = new AudioContext();
                        log('js', `‚úÖ Audio Context: Available (${ctx.state})`);
                    } else {
                        log('js', '‚ùå Audio Context: Not available');
                    }
                } catch (e) {
                    log('js', `‚ùå Audio Context: Error - ${e.message}`);
                }

                setStatus('js', 'success', 'All OK');
                testResults.js = true;

            } catch (error) {
                log('js', `‚ùå JavaScript error: ${error.message}`);
                setStatus('js', 'error', 'JS Error');
                testResults.js = false;
            }

            updateSummary();
        }

        async function runAudioTest() {
            log('audio', 'üîä Testing audio system...');
            setStatus('audio', 'running');

            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) {
                    log('audio', '‚ùå Web Audio API not supported');
                    setStatus('audio', 'error', 'No Web Audio');
                    testResults.audio = false;
                    updateSummary();
                    return;
                }

                const audioContext = new AudioContext();
                log('audio', `‚úÖ Audio context created: ${audioContext.state}`);

                // Test oscillator creation
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                log('audio', '‚úÖ Audio nodes created successfully');

                // Test parameter setting
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                log('audio', '‚úÖ Audio parameters set successfully');

                // Test actual sound (requires user interaction)
                log('audio', 'üéµ Click to test actual sound playback...');

                document.addEventListener('click', function testAudioPlayback() {
                    if (audioContext.state === 'suspended') {
                        audioContext.resume().then(() => {
                            log('audio', '‚úÖ Audio context resumed after user interaction');
                            playTestTone();
                        });
                    } else {
                        playTestTone();
                    }

                    function playTestTone() {
                        try {
                            const osc = audioContext.createOscillator();
                            const gain = audioContext.createGain();
                            osc.connect(gain);
                            gain.connect(audioContext.destination);
                            osc.frequency.value = 800;
                            gain.gain.setValueAtTime(0, audioContext.currentTime);
                            gain.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.01);
                            gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
                            osc.start();
                            osc.stop(audioContext.currentTime + 0.2);
                            log('audio', 'üîä Test tone played successfully!');
                        } catch (e) {
                            log('audio', `‚ùå Sound playback failed: ${e.message}`);
                        }
                    }

                    document.removeEventListener('click', testAudioPlayback);
                }, { once: true });

                setStatus('audio', 'success', 'Ready');
                testResults.audio = true;

            } catch (error) {
                log('audio', `‚ùå Audio system error: ${error.message}`);
                setStatus('audio', 'error', 'Audio Error');
                testResults.audio = false;
            }

            updateSummary();
        }

        async function runUITest() {
            log('ui', 'üé® Testing UI rendering capabilities...');
            setStatus('ui', 'running');

            try {
                // Test CSS support
                const testEl = document.createElement('div');
                document.body.appendChild(testEl);

                // Test CSS Grid
                testEl.style.display = 'grid';
                const gridSupported = getComputedStyle(testEl).display === 'grid';
                log('ui', `CSS Grid: ${gridSupported ? '‚úÖ' : '‚ùå'}`);

                // Test CSS Flexbox
                testEl.style.display = 'flex';
                const flexSupported = getComputedStyle(testEl).display === 'flex';
                log('ui', `CSS Flexbox: ${flexSupported ? '‚úÖ' : '‚ùå'}`);

                // Test CSS Transforms
                testEl.style.transform = 'rotate(1deg)';
                const transformSupported = getComputedStyle(testEl).transform !== 'none';
                log('ui', `CSS Transforms: ${transformSupported ? '‚úÖ' : '‚ùå'}`);

                // Test backdrop-filter
                testEl.style.backdropFilter = 'blur(10px)';
                const backdropSupported = getComputedStyle(testEl).backdropFilter !== 'none';
                log('ui', `CSS Backdrop Filter: ${backdropSupported ? '‚úÖ' : '‚ùå'}`);

                document.body.removeChild(testEl);

                // Test viewport
                const viewport = document.querySelector('meta[name="viewport"]');
                log('ui', `Viewport meta: ${viewport ? '‚úÖ' : '‚ùå'}`);

                // Test device info
                log('ui', `Screen: ${window.screen.width}x${window.screen.height}`);
                log('ui', `Viewport: ${window.innerWidth}x${window.innerHeight}`);
                log('ui', `Device Pixel Ratio: ${window.devicePixelRatio || 1}`);
                log('ui', `Touch Support: ${('ontouchstart' in window) ? '‚úÖ' : '‚ùå'}`);

                const supportScore = [gridSupported, flexSupported, transformSupported].filter(Boolean).length;

                if (supportScore >= 2) {
                    setStatus('ui', 'success', `${supportScore}/3 features`);
                    testResults.ui = true;
                } else {
                    setStatus('ui', 'warning', `${supportScore}/3 features`);
                    testResults.ui = false;
                }

            } catch (error) {
                log('ui', `‚ùå UI test error: ${error.message}`);
                setStatus('ui', 'error', 'UI Error');
                testResults.ui = false;
            }

            updateSummary();
        }

        async function runPerfTest() {
            log('perf', '‚ö° Testing performance...');
            setStatus('perf', 'running');

            try {
                // Memory usage
                if (performance.memory) {
                    const memory = performance.memory;
                    const usedMB = (memory.usedJSHeapSize / 1048576).toFixed(1);
                    const limitMB = (memory.jsHeapSizeLimit / 1048576).toFixed(1);
                    log('perf', `Memory: ${usedMB}MB / ${limitMB}MB used`);
                } else {
                    log('perf', 'Memory info: Not available');
                }

                // Performance timing
                if (performance.timing) {
                    const timing = performance.timing;
                    const loadTime = timing.loadEventEnd - timing.navigationStart;
                    log('perf', `Page load time: ${loadTime}ms`);
                } else {
                    log('perf', 'Performance timing: Not available');
                }

                // Test main app load time
                const start = performance.now();
                const response = await fetch(BASE_URL);
                const html = await response.text();
                const end = performance.now();
                const fetchTime = Math.round(end - start);

                log('perf', `Main app fetch time: ${fetchTime}ms`);
                log('perf', `Main app size: ${html.length} characters`);

                if (fetchTime < 1000) {
                    setStatus('perf', 'success', `${fetchTime}ms`);
                    testResults.perf = true;
                } else {
                    setStatus('perf', 'warning', `${fetchTime}ms`);
                    testResults.perf = false;
                }

            } catch (error) {
                log('perf', `‚ùå Performance test error: ${error.message}`);
                setStatus('perf', 'error', 'Perf Error');
                testResults.perf = false;
            }

            updateSummary();
        }

        async function runBrowserTest() {
            log('browser', 'üåç Testing browser compatibility...');
            setStatus('browser', 'running');

            try {
                const ua = navigator.userAgent;
                log('browser', `User Agent: ${ua}`);

                // Detect browser
                const browsers = {
                    chrome: /Chrome/i.test(ua) && !/Edge/i.test(ua),
                    firefox: /Firefox/i.test(ua),
                    safari: /Safari/i.test(ua) && !/Chrome/i.test(ua),
                    edge: /Edge/i.test(ua),
                    ie: /MSIE|Trident/i.test(ua)
                };

                const currentBrowser = Object.keys(browsers).find(key => browsers[key]) || 'unknown';
                log('browser', `Detected browser: ${currentBrowser}`);

                // Feature support
                const features = {
                    es6: typeof Symbol !== 'undefined',
                    asyncAwait: (async () => {})().constructor === Promise,
                    fetch: typeof fetch === 'function',
                    webAudio: !!(window.AudioContext || window.webkitAudioContext),
                    localStorage: (() => {
                        try {
                            localStorage.setItem('test', 'test');
                            localStorage.removeItem('test');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    })(),
                    serviceWorker: 'serviceWorker' in navigator
                };

                log('browser', 'Feature support:');
                Object.entries(features).forEach(([feature, supported]) => {
                    log('browser', `  ${feature}: ${supported ? '‚úÖ' : '‚ùå'}`);
                });

                const supportedFeatures = Object.values(features).filter(Boolean).length;
                const totalFeatures = Object.keys(features).length;

                log('browser', `Feature support: ${supportedFeatures}/${totalFeatures}`);

                if (supportedFeatures >= totalFeatures - 1) {
                    setStatus('browser', 'success', `${supportedFeatures}/${totalFeatures}`);
                    testResults.browser = true;
                } else {
                    setStatus('browser', 'warning', `${supportedFeatures}/${totalFeatures}`);
                    testResults.browser = false;
                }

            } catch (error) {
                log('browser', `‚ùå Browser test error: ${error.message}`);
                setStatus('browser', 'error', 'Browser Error');
                testResults.browser = false;
            }

            updateSummary();
        }

        async function runLiveTest() {
            log('live', 'üéØ Testing main app live functionality...');
            setStatus('live', 'running');

            try {
                // Test main page load
                const response = await fetch(BASE_URL);
                const html = await response.text();
                log('live', `‚úÖ Main page loaded (${html.length} chars)`);

                // Check for critical elements
                const checks = [
                    { name: 'Loading screen', pattern: /loading-screen/ },
                    { name: 'Main screen', pattern: /main-screen/ },
                    { name: 'Settings panel', pattern: /settings-panel/ },
                    { name: 'Audio elements', pattern: /<audio id/ },
                    { name: 'Enhanced CSS', pattern: /style-enhanced\.css/ },
                    { name: 'Fixed audio manager', pattern: /audio-manager-fixed\.js/ },
                    { name: 'Questions data', pattern: /questions\.js/ },
                    { name: 'App initialization', pattern: /DOMContentLoaded/ }
                ];

                let passed = 0;
                checks.forEach(check => {
                    if (check.pattern.test(html)) {
                        log('live', `‚úÖ ${check.name}: Found`);
                        passed++;
                    } else {
                        log('live', `‚ùå ${check.name}: Missing`);
                    }
                });

                log('live', `Structure check: ${passed}/${checks.length} elements found`);

                if (passed >= checks.length - 1) {
                    setStatus('live', 'success', `${passed}/${checks.length}`);
                    testResults.live = true;
                } else {
                    setStatus('live', 'error', `${passed}/${checks.length}`);
                    testResults.live = false;
                }

            } catch (error) {
                log('live', `‚ùå Live test error: ${error.message}`);
                setStatus('live', 'error', 'Live Error');
                testResults.live = false;
            }

            updateSummary();
        }

        function onIframeLoad() {
            log('embed', '‚úÖ Main app iframe loaded successfully');
            setStatus('embed', 'success', 'Loaded');

            // Try to access iframe content (may fail due to CORS)
            try {
                const iframe = document.getElementById('main-app-iframe');
                const doc = iframe.contentDocument || iframe.contentWindow.document;
                log('embed', `‚úÖ Iframe content accessible`);

                // Check if loading screen is visible
                setTimeout(() => {
                    try {
                        const loadingScreen = doc.querySelector('#loading-screen');
                        if (loadingScreen) {
                            const isVisible = !loadingScreen.classList.contains('hidden');
                            log('embed', `Loading screen: ${isVisible ? 'Visible' : 'Hidden'}`);
                        }
                    } catch (e) {
                        log('embed', 'Cannot access iframe content (CORS restriction)');
                    }
                }, 2000);

            } catch (e) {
                log('embed', 'Cannot access iframe content (CORS restriction)');
            }
        }

        function onIframeError() {
            log('embed', '‚ùå Main app iframe failed to load');
            setStatus('embed', 'error', 'Failed');
        }

        async function runAllTests() {
            log('summary', 'üöÄ Starting comprehensive test suite...');
            document.getElementById('run-all-btn').disabled = true;

            const tests = [
                runNetworkTest,
                runFileTest,
                runJSTest,
                runAudioTest,
                runUITest,
                runPerfTest,
                runBrowserTest,
                runLiveTest
            ];

            for (let i = 0; i < tests.length; i++) {
                log('summary', `Running test ${i + 1}/${tests.length}...`);
                await tests[i]();
                await new Promise(resolve => setTimeout(resolve, 500)); // Small delay between tests
            }

            // Generate final summary
            const results = Object.values(testResults);
            const passed = results.filter(r => r === true).length;
            const failed = results.filter(r => r === false).length;
            const total = results.length;
            const successRate = Math.round((passed / total) * 100);

            log('summary', '\nüìä FINAL TEST RESULTS');
            log('summary', '='.repeat(50));
            log('summary', `Tests Passed: ${passed}/${total} (${successRate}%)`);
            log('summary', `Network: ${testResults.network ? '‚úÖ' : '‚ùå'}`);
            log('summary', `Files: ${testResults.files ? '‚úÖ' : '‚ùå'}`);
            log('summary', `JavaScript: ${testResults.js ? '‚úÖ' : '‚ùå'}`);
            log('summary', `Audio: ${testResults.audio ? '‚úÖ' : '‚ùå'}`);
            log('summary', `UI: ${testResults.ui ? '‚úÖ' : '‚ùå'}`);
            log('summary', `Performance: ${testResults.perf ? '‚úÖ' : '‚ùå'}`);
            log('summary', `Browser: ${testResults.browser ? '‚úÖ' : '‚ùå'}`);
            log('summary', `Live App: ${testResults.live ? '‚úÖ' : '‚ùå'}`);

            if (successRate >= 90) {
                log('summary', '\nüéâ EXCELLENT: App should work perfectly!');
            } else if (successRate >= 70) {
                log('summary', '\nüëç GOOD: App should work with minor issues');
            } else {
                log('summary', '\n‚ö†Ô∏è ISSUES FOUND: App may have problems');
            }

            log('summary', '\nüîç RECOMMENDATIONS:');
            if (!testResults.live) {
                log('summary', '‚Ä¢ Main app has structural issues - check JavaScript console');
            }
            if (!testResults.files) {
                log('summary', '‚Ä¢ Some files are missing or not loading properly');
            }
            if (!testResults.audio) {
                log('summary', '‚Ä¢ Audio system needs attention');
            }
            if (!testResults.js) {
                log('summary', '‚Ä¢ JavaScript execution problems detected');
            }

            document.getElementById('run-all-btn').disabled = false;
        }

        function exportResults() {
            const summary = document.getElementById('summary-log').textContent;
            const blob = new Blob([summary], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'quiz-master-test-results.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            log('summary', 'üß™ Advanced Test Suite ready');
            log('summary', 'Click "Run All Tests" to start comprehensive testing');
        });
    </script>
</body>
</html>