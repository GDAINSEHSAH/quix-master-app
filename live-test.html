<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live App Performance Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
            font-size: 12px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🧪 Live App Performance Analysis</h1>
        <p>This will test the actual live app at <code>https://gdainsehsah.github.io/quix-master-app</code></p>

        <button onclick="runCompleteTest()">🚀 Run Complete Test</button>
        <button onclick="testLiveApp()">🌐 Test Live App</button>
        <button onclick="clearLogs()">🗑️ Clear Logs</button>

        <div class="test-grid">
            <div class="test-section">
                <h3>📡 Network Tests</h3>
                <div id="network-status" class="status info">Testing...</div>
                <div id="network-log" class="log">Network test log will appear here...</div>
            </div>

            <div class="test-section">
                <h3>📄 HTML Loading</h3>
                <div id="html-status" class="status info">Testing...</div>
                <div id="html-log" class="log">HTML loading log will appear here...</div>
            </div>

            <div class="test-section">
                <h3>📜 JavaScript Loading</h3>
                <div id="js-status" class="status info">Testing...</div>
                <div id="js-log" class="log">JavaScript loading log will appear here...</div>
            </div>

            <div class="test-section">
                <h3>🔊 Audio System</h3>
                <div id="audio-status" class="status info">Testing...</div>
                <div id="audio-log" class="log">Audio system log will appear here...</div>
            </div>

            <div class="test-section">
                <h3>🎮 Game Functionality</h3>
                <div id="game-status" class="status info">Testing...</div>
                <div id="game-log" class="log">Game functionality log will appear here...</div>
            </div>

            <div class="test-section">
                <h3>📱 Mobile Compatibility</h3>
                <div id="mobile-status" class="status info">Testing...</div>
                <div id="mobile-log" class="log">Mobile compatibility log will appear here...</div>
            </div>
        </div>

        <div class="test-section">
            <h3>📊 Overall Performance Report</h3>
            <div id="overall-status" class="status info">Run tests to see overall status</div>
            <div id="overall-log" class="log">Overall performance report will appear here...</div>
        </div>
    </div>

    <script>
        const BASE_URL = 'https://gdainsehsah.github.io/quix-master-app';

        function log(section, message) {
            const logEl = document.getElementById(`${section}-log`);
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(`[${section}] ${message}`);
        }

        function setStatus(section, message, type = 'info') {
            const statusEl = document.getElementById(`${section}-status`);
            statusEl.className = `status ${type}`;
            statusEl.textContent = message;
        }

        function clearLogs() {
            ['network', 'html', 'js', 'audio', 'game', 'mobile', 'overall'].forEach(section => {
                document.getElementById(`${section}-log`).textContent = '';
                setStatus(section, 'Ready for testing', 'info');
            });
        }

        async function testNetwork() {
            log('network', '🌐 Testing network connectivity...');
            setStatus('network', 'Testing network...', 'warning');

            try {
                const start = performance.now();
                const response = await fetch(BASE_URL, { method: 'HEAD' });
                const end = performance.now();
                const loadTime = Math.round(end - start);

                if (response.ok) {
                    log('network', `✅ Main page accessible (${loadTime}ms)`);
                    log('network', `Status: ${response.status} ${response.statusText}`);
                    log('network', `Headers: ${JSON.stringify(Object.fromEntries(response.headers))}`);
                    setStatus('network', `✅ Network OK (${loadTime}ms)`, 'success');
                    return true;
                } else {
                    log('network', `❌ HTTP error: ${response.status}`);
                    setStatus('network', `❌ HTTP Error: ${response.status}`, 'error');
                    return false;
                }
            } catch (error) {
                log('network', `❌ Network error: ${error.message}`);
                setStatus('network', `❌ Network failed: ${error.message}`, 'error');
                return false;
            }
        }

        async function testHTML() {
            log('html', '📄 Testing HTML content...');
            setStatus('html', 'Loading HTML...', 'warning');

            try {
                const response = await fetch(BASE_URL);
                const html = await response.text();

                log('html', `✅ HTML loaded (${html.length} chars)`);

                // Check for key elements
                const checks = [
                    { name: 'Audio Manager Fixed', pattern: /audio-manager-fixed\.js/ },
                    { name: 'Integration Fixer', pattern: /integration-fixer\.js/ },
                    { name: 'Debug Test Suite', pattern: /debug-test-suite\.js/ },
                    { name: 'Premium Features', pattern: /Premium Features/ },
                    { name: 'Audio Elements', pattern: /<audio id/ },
                    { name: 'Loading Screen', pattern: /loading-screen/ },
                    { name: 'Settings Panel', pattern: /settings-panel/ }
                ];

                let passed = 0;
                checks.forEach(check => {
                    if (check.pattern.test(html)) {
                        log('html', `✅ ${check.name} found`);
                        passed++;
                    } else {
                        log('html', `❌ ${check.name} missing`);
                    }
                });

                if (passed === checks.length) {
                    setStatus('html', `✅ HTML Complete (${passed}/${checks.length})`, 'success');
                } else {
                    setStatus('html', `⚠️ HTML Issues (${passed}/${checks.length})`, 'warning');
                }

                return { html, passed, total: checks.length };
            } catch (error) {
                log('html', `❌ HTML loading failed: ${error.message}`);
                setStatus('html', `❌ HTML failed: ${error.message}`, 'error');
                return null;
            }
        }

        async function testJavaScript() {
            log('js', '📜 Testing JavaScript files...');
            setStatus('js', 'Testing JS files...', 'warning');

            const jsFiles = [
                'js/audio-manager-fixed.js',
                'js/integration-fixer.js',
                'js/debug-test-suite.js',
                'js/achievements-system.js',
                'js/powerups-system.js',
                'js/data-manager-enhanced.js',
                'js/game-logic-enhanced.js',
                'js/ui-manager-enhanced.js',
                'js/app-enhanced.js'
            ];

            let loadedFiles = 0;
            let errors = [];

            for (const file of jsFiles) {
                try {
                    const response = await fetch(`${BASE_URL}/${file}`);
                    if (response.ok) {
                        const content = await response.text();
                        log('js', `✅ ${file} (${content.length} chars)`);

                        // Check for syntax errors
                        if (content.includes('class ') || content.includes('function ')) {
                            log('js', `   Contains classes/functions ✓`);
                        }

                        loadedFiles++;
                    } else {
                        log('js', `❌ ${file} - HTTP ${response.status}`);
                        errors.push(`${file}: HTTP ${response.status}`);
                    }
                } catch (error) {
                    log('js', `❌ ${file} - ${error.message}`);
                    errors.push(`${file}: ${error.message}`);
                }
            }

            if (errors.length === 0) {
                setStatus('js', `✅ All JS files loaded (${loadedFiles}/${jsFiles.length})`, 'success');
            } else {
                setStatus('js', `⚠️ JS issues (${loadedFiles}/${jsFiles.length})`, 'warning');
                log('js', `Errors: ${errors.join(', ')}`);
            }

            return { loaded: loadedFiles, total: jsFiles.length, errors };
        }

        async function testAudioSystem() {
            log('audio', '🔊 Testing audio system...');
            setStatus('audio', 'Testing audio...', 'warning');

            try {
                // Test Web Audio API support
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) {
                    log('audio', '❌ Web Audio API not supported');
                    setStatus('audio', '❌ No Web Audio support', 'error');
                    return false;
                }

                log('audio', '✅ Web Audio API supported');

                // Test audio context creation
                const audioContext = new AudioContext();
                log('audio', `✅ Audio context created: ${audioContext.state}`);

                // Test oscillator (our sound generation method)
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                log('audio', '✅ Oscillator and gain nodes created');

                // Test if we can set frequency and gain
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);

                log('audio', '✅ Audio parameters set successfully');

                // Test actual sound playback (user interaction required)
                log('audio', '⚠️ Actual sound test requires user interaction');
                log('audio', 'Click anywhere to test actual sound playback...');

                // Set up click test
                document.addEventListener('click', function testSound() {
                    if (audioContext.state === 'suspended') {
                        audioContext.resume().then(() => {
                            log('audio', '✅ Audio context resumed after user interaction');
                            playTestSound(audioContext);
                        });
                    } else {
                        playTestSound(audioContext);
                    }
                    document.removeEventListener('click', testSound);
                }, { once: true });

                setStatus('audio', '✅ Audio system ready - click to test', 'success');
                return true;

            } catch (error) {
                log('audio', `❌ Audio system error: ${error.message}`);
                setStatus('audio', `❌ Audio error: ${error.message}`, 'error');
                return false;
            }
        }

        function playTestSound(audioContext) {
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.type = 'sine';

                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3);

                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);

                log('audio', '🔊 Test sound played successfully!');
                setStatus('audio', '✅ Audio working perfectly!', 'success');
            } catch (error) {
                log('audio', `❌ Sound playback failed: ${error.message}`);
                setStatus('audio', `❌ Playback failed: ${error.message}`, 'error');
            }
        }

        async function testGameFunctionality() {
            log('game', '🎮 Testing game functionality...');
            setStatus('game', 'Testing game...', 'warning');

            try {
                // Test if we can load the questions database
                const response = await fetch(`${BASE_URL}/data/questions.js`);
                if (response.ok) {
                    const content = await response.text();
                    log('game', `✅ Questions database loaded (${content.length} chars)`);

                    if (content.includes('science') && content.includes('history')) {
                        log('game', '✅ Database contains expected sections');
                    } else {
                        log('game', '⚠️ Database structure may be incomplete');
                    }
                } else {
                    log('game', `❌ Questions database failed: HTTP ${response.status}`);
                }

                // Test CSS loading
                const cssResponse = await fetch(`${BASE_URL}/css/style-enhanced.css`);
                if (cssResponse.ok) {
                    log('game', '✅ Enhanced CSS loaded');
                } else {
                    log('game', '❌ Enhanced CSS missing');
                }

                // Test manifest for PWA
                const manifestResponse = await fetch(`${BASE_URL}/manifest.json`);
                if (manifestResponse.ok) {
                    log('game', '✅ PWA manifest found');
                } else {
                    log('game', '⚠️ PWA manifest missing');
                }

                setStatus('game', '✅ Game resources loaded', 'success');
                return true;

            } catch (error) {
                log('game', `❌ Game functionality test failed: ${error.message}`);
                setStatus('game', `❌ Game test failed: ${error.message}`, 'error');
                return false;
            }
        }

        async function testMobileCompatibility() {
            log('mobile', '📱 Testing mobile compatibility...');
            setStatus('mobile', 'Testing mobile...', 'warning');

            const isMobile = /Mobi|Android/i.test(navigator.userAgent);
            const isTablet = /Tablet|iPad/i.test(navigator.userAgent);
            const hasTouch = 'ontouchstart' in window;

            log('mobile', `Device type: ${isMobile ? 'Mobile' : isTablet ? 'Tablet' : 'Desktop'}`);
            log('mobile', `Touch support: ${hasTouch ? 'Yes' : 'No'}`);
            log('mobile', `Screen: ${window.screen.width}x${window.screen.height}`);
            log('mobile', `Viewport: ${window.innerWidth}x${window.innerHeight}`);
            log('mobile', `Pixel ratio: ${window.devicePixelRatio || 1}`);

            // Test viewport meta tag
            const viewport = document.querySelector('meta[name="viewport"]');
            if (viewport) {
                log('mobile', '✅ Viewport meta tag present');
            } else {
                log('mobile', '⚠️ Viewport meta tag missing');
            }

            // Test responsive design
            if (window.innerWidth < 768) {
                log('mobile', '📱 Mobile viewport detected');
            } else if (window.innerWidth < 1024) {
                log('mobile', '📊 Tablet viewport detected');
            } else {
                log('mobile', '🖥️ Desktop viewport detected');
            }

            setStatus('mobile', '✅ Mobile compatibility checked', 'success');
            return true;
        }

        async function testLiveApp() {
            log('overall', '🌐 Opening live app in new tab...');
            window.open(BASE_URL, '_blank');
            log('overall', '✅ Live app opened - test manually for sound effects');
        }

        async function runCompleteTest() {
            log('overall', '🚀 Starting complete performance test...');
            clearLogs();

            const results = {
                network: false,
                html: null,
                js: null,
                audio: false,
                game: false,
                mobile: false
            };

            // Run all tests
            results.network = await testNetwork();
            results.html = await testHTML();
            results.js = await testJavaScript();
            results.audio = await testAudioSystem();
            results.game = await testGameFunctionality();
            results.mobile = await testMobileCompatibility();

            // Generate overall report
            let score = 0;
            let maxScore = 6;

            if (results.network) score++;
            if (results.html && results.html.passed === results.html.total) score++;
            if (results.js && results.js.errors.length === 0) score++;
            if (results.audio) score++;
            if (results.game) score++;
            if (results.mobile) score++;

            log('overall', `\n📊 COMPLETE PERFORMANCE REPORT`);
            log('overall', `${'='.repeat(50)}`);
            log('overall', `Overall Score: ${score}/${maxScore} (${Math.round(score/maxScore*100)}%)`);
            log('overall', `Network: ${results.network ? '✅' : '❌'}`);
            log('overall', `HTML: ${results.html ? `✅ (${results.html.passed}/${results.html.total})` : '❌'}`);
            log('overall', `JavaScript: ${results.js ? `✅ (${results.js.loaded}/${results.js.total})` : '❌'}`);
            log('overall', `Audio: ${results.audio ? '✅' : '❌'}`);
            log('overall', `Game: ${results.game ? '✅' : '❌'}`);
            log('overall', `Mobile: ${results.mobile ? '✅' : '❌'}`);

            if (score === maxScore) {
                setStatus('overall', '✅ All tests passed!', 'success');
                log('overall', '\n🎉 ALL TESTS PASSED! App should be working perfectly.');
            } else if (score >= 4) {
                setStatus('overall', `⚠️ Mostly working (${score}/${maxScore})`, 'warning');
                log('overall', '\n⚠️ Some issues found, but app should mostly work.');
            } else {
                setStatus('overall', `❌ Critical issues (${score}/${maxScore})`, 'error');
                log('overall', '\n❌ Critical issues found, app may not work properly.');
            }

            // Specific recommendations
            if (!results.audio) {
                log('overall', '\n🔊 AUDIO ISSUE: Sound effects not working properly');
                log('overall', 'Recommendation: Check browser audio permissions and Web Audio API support');
            }

            if (results.js && results.js.errors.length > 0) {
                log('overall', '\n📜 JAVASCRIPT ISSUES:');
                results.js.errors.forEach(error => log('overall', `   • ${error}`));
            }

            log('overall', '\n🎯 Next Steps:');
            log('overall', '1. Test the live app manually at the URL above');
            log('overall', '2. Check browser console for any JavaScript errors');
            log('overall', '3. Test sound effects by answering quiz questions');
            log('overall', '4. Try on different devices/browsers');

            return results;
        }

        // Auto-run basic tests on load
        document.addEventListener('DOMContentLoaded', () => {
            log('overall', '🧪 Performance tester ready');
            log('overall', 'Click "Run Complete Test" to start comprehensive testing');
        });
    </script>
</body>
</html>